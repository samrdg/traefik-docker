version: "3.8"
services:
  traefik:
    image: traefik:chevrotin
    container_name: traefik
    networks:
      - outside
    command:
      # docker backend
      - "--providers.docker=true"
      # services are not exposed by default
      - "--providers.docker.exposedbydefault=false"
      # dynamic configuration folder
      - "--providers.file.directory=/dc"
      # enable HTTP entrypoint and redirect to HTTPS
      - "--entrypoints.web.address=:80"
      - "--entrypoints.web.http.redirections.entrypoint.to=websecure"
      # enable HTTPS entrypoint
      - "--entrypoints.websecure.address=:443"
      # enable TLS
      - "--entrypoints.websecure.http.tls=true"
      # Let's encrypt SSL certificate
      - "--entrypoints.websecure.http.tls.certresolver=le"
      - "--certificatesresolvers.le.acme.tlschallenge=true"
      - "--certificatesresolvers.le.acme.email=name@domain.localhost"
      - "--certificatesresolvers.le.acme.storage=/le/acme.json"
    ports:
      - "443:443"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "./dc:/dc"
      - "./le:/le"

# create a network to the outside for traefik
networks:
  outside:
    name: traefik-outside-net
